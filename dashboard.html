<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css"
    />
    <link
      href="https://cdn.datatables.net/buttons/1.5.1/css/buttons.dataTables.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./reboot.css" />
    <style>
      .pt-12 {
        padding-top: 12px;
      }
      .mt-16 {
        margin-top: 16px;
      }
      .mb-8 {
        margin-bottom: 8px;
      }
      .mt-5px {
        margin-top: 5px;
      }
      /* project type */
      .mb-20 {
        margin-bottom: 20px;
      }
      .mb-25 {
        margin-bottom: 25px;
      }
      .mb-30 {
        margin-bottom: 30px;
      }
      .mb-46 {
        margin-bottom: 46px;
      }
      .mb-50 {
        margin-bottom: 50px;
      }
      .mb-38 {
        margin-bottom: 38px;
      }
      .mr-20 {
        margin-right: 20px;
      }
      .fz-16 {
        font-size: 16px !important;
      }
      /* Dashboard */
      .app-main {
        height: calc(100vh - 0px);
      }
      .app-mainContent {
        padding: 25px;
        background-color: #f2f3f8;
      }
      .app-mainBody {
        height: 100%;
        padding-top: 60px;
        padding-left: 265px;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        -ms-flex-direction: column;
        flex-direction: column;
      }
      .app-extra-space {
        -webkit-box-flex: 1;
        -ms-flex: 1 0 auto;
        flex: 1 0 auto;
        display: flex;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        -ms-flex-direction: column;
        flex-direction: column;
        max-width: 100%;
        background-color: #f2f3f8;
      }
      .app-header {
        position: absolute;
        top: 15px;
        color: red;
        padding: 0 10px;
      }
      .app-aside {
        position: fixed;
        top: 0;
        bottom: 0;
        left: 0;
        z-index: 98;
        max-width: 100%;
        background-color: #ffffff;
        -webkit-transition: all 0.3s ease;
        transition: all 0.6s ease;
      }
      .app-aside {
        width: 265px;
      }
      .app-mainBody {
        padding-left: 265px;
      }
      .logo-wrapper {
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 265px;
        padding: 15px 20px;
        border-bottom: 1px solid #eff0f6;
        background-color: #3c3839;
        transition: all 0.4s ease;
      }
      .logo-img {
        filter: invert(1) grayscale(1) brightness(3);
      }
      .aside-content ul {
        list-style-type: none;
        padding-left: 0;
      }
      .aside-content button {
        height: 48px;
        border: 0;
        background-color: white;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        cursor: pointer;
        text-indent: 0;
        transition: all 0.4s ease-in-out;
      }

      .app-aside .logo-wrapper img {
        text-indent: 0;
      }
      .aside-content button:hover {
        background-color: #f2f3f8;
      }
      .aside-content button i {
        font-size: 20px;
        opacity: 0;
      }
      .aside-content button.active {
        background-color: #f2f3f8;
      }
      .aside-content button:focus {
        border: 0;
        outline: none;
      }
      .aside-content button.active i {
        opacity: 1;
      }
      .dataTables_wrapper {
        background-color: white;
        padding: 20px;
        border-radius: 4px;
      }
      .dataTables_length {
        margin-bottom: 10px;
      }
      .dataTables_wrapper .dataTables_length select,
      .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #ebedf2 !important;
      }
      .dataTables_scrollHead .dataTable {
        border-top: 1px solid #ebedf2 !important;
      }
      .dataTables_scrollBody .dataTable {
        border-bottom: 1px solid #ebedf2 !important;
      }
      .dataTable {
        border-left: 1px solid #ebedf2 !important;
        border-right: 1px solid #ebedf2 !important;
      }
      .dataTables_wrapper.no-footer .dataTables_scrollBody {
        border-bottom: none !important;
      }
      table.dataTable thead th {
        border-bottom: 1px solid #ebedf2 !important;
      }
      .dt-buttons button.dt-button {
        border: 1px solid #ebedf2 !important;
        background-image: none !important;
        border-radius: 4px !important;
        background-color: white !important;
        height: 36px !important;
        padding: 0 10px !important;
      }
      .dataTables_wrapper .dataTables_paginate .paginate_button.current,
      .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
        border: 1px solid #ebedf2 !important;
        background: #f2f3f8;
        padding: 3px 12px;
        border-radius: 4px;
      }

      .dataTables_wrapper .dataTables_paginate .paginate_button,
      .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
        padding: 3px 12px;
        border-radius: 4px;
      }
      .dataTables_wrapper .dataTables_scroll {
        padding-top: 10px;
      }
      .dataTables_wrapper .dataTables_info,
      .dataTables_wrapper .dataTables_paginate {
        padding-top: 20px;
      }
      .btn-search {
        background-color: #3c3839;
        color: white;
        border-radius: 4px;
        border: 0;
        padding: 0 15px;
      }
      @media screen and (max-width: 960px) {
        .app-mainBody {
          padding: 0;
        }
        .app-mainContent {
          margin-top: 60px;
          padding: 10px;
        }

        div.dt-buttons,
        .dataTables_paginate,
        .dataTables_filter,
        .dataTables_info {
          text-align: left !important;
        }
        .dataTables_filter label,
        .dataTables_filter input {
          width: 100%;
        }
      }
      .no-js #loader {
        display: none;
      }
      .js #loader {
        display: block;
        position: absolute;
        left: 100px;
        top: 0;
      }
      /* Loader */
      .se-pre-con {
        position: fixed;
        left: 0px;
        top: 0px;
        width: 100%;
        height: 100%;
        z-index: 9999;
        background-color: #f58020;
        overflow: hidden;
        text-align: center;
        display: flex;
        justify-content: center;
        align-items: center;
        background-position-y: 35%;
        font-size: 18px;
      }
      .loader-body {
        position: absolute;
        top: 40%;
        margin-left: -50px;
        left: 49%;
        animation: speeder 0.4s linear infinite;
      }
      .loader-body > span {
        height: 5px;
        width: 35px;
        background: #000;
        position: absolute;
        top: -19px;
        left: 60px;
        border-radius: 2px 10px 1px 0;
      }

      .base span {
        position: absolute;
        width: 0;
        height: 0;
        border-top: 6px solid transparent;
        border-right: 100px solid #000;
        border-bottom: 6px solid transparent;
      }
      .base span:before {
        content: "";
        height: 22px;
        width: 22px;
        border-radius: 50%;
        background: #000;
        position: absolute;
        right: -110px;
        top: -16px;
      }
      .base span:after {
        content: "";
        position: absolute;
        width: 0;
        height: 0;
        border-top: 0 solid transparent;
        border-right: 55px solid #000;
        border-bottom: 16px solid transparent;
        top: -16px;
        right: -98px;
      }

      .face {
        position: absolute;
        height: 12px;
        width: 20px;
        background: #000;
        border-radius: 20px 20px 0 0;
        transform: rotate(-40deg);
        right: -125px;
        top: -15px;
      }
      .face:after {
        content: "";
        height: 12px;
        width: 12px;
        background: #000;
        right: 4px;
        top: 7px;
        position: absolute;
        transform: rotate(40deg);
        transform-origin: 50% 50%;
        border-radius: 0 0 0 2px;
      }

      .loader-body > span > span:nth-child(1),
      .loader-body > span > span:nth-child(2),
      .loader-body > span > span:nth-child(3),
      .loader-body > span > span:nth-child(4) {
        width: 30px;
        height: 1px;
        background: #000;
        position: absolute;
        animation: fazer1 0.2s linear infinite;
      }

      .loader-body > span > span:nth-child(2) {
        top: 3px;
        animation: fazer2 0.4s linear infinite;
      }

      .loader-body > span > span:nth-child(3) {
        top: 1px;
        animation: fazer3 0.4s linear infinite;
        animation-delay: -1s;
      }

      .loader-body > span > span:nth-child(4) {
        top: 4px;
        animation: fazer4 1s linear infinite;
        animation-delay: -1s;
      }

      @keyframes fazer1 {
        0% {
          left: 0;
        }
        100% {
          left: -80px;
          opacity: 0;
        }
      }
      @keyframes fazer2 {
        0% {
          left: 0;
        }
        100% {
          left: -100px;
          opacity: 0;
        }
      }
      @keyframes fazer3 {
        0% {
          left: 0;
        }
        100% {
          left: -50px;
          opacity: 0;
        }
      }
      @keyframes fazer4 {
        0% {
          left: 0;
        }
        100% {
          left: -150px;
          opacity: 0;
        }
      }
      @keyframes speeder {
        0% {
          transform: translate(2px, 1px) rotate(0deg);
        }
        10% {
          transform: translate(-1px, -3px) rotate(-1deg);
        }
        20% {
          transform: translate(-2px, 0px) rotate(1deg);
        }
        30% {
          transform: translate(1px, 2px) rotate(0deg);
        }
        40% {
          transform: translate(1px, -1px) rotate(1deg);
        }
        50% {
          transform: translate(-1px, 3px) rotate(-1deg);
        }
        60% {
          transform: translate(-1px, 1px) rotate(0deg);
        }
        70% {
          transform: translate(3px, 1px) rotate(-1deg);
        }
        80% {
          transform: translate(-2px, -1px) rotate(1deg);
        }
        90% {
          transform: translate(2px, 1px) rotate(0deg);
        }
        100% {
          transform: translate(1px, -2px) rotate(-1deg);
        }
      }
      .longfazers {
        position: absolute;
        width: 100%;
        height: 100%;
      }
      .longfazers span {
        position: absolute;
        height: 2px;
        width: 20%;
        background: #000;
      }
      .longfazers span:nth-child(1) {
        top: 20%;
        animation: lf 0.6s linear infinite;
        animation-delay: -5s;
      }
      .longfazers span:nth-child(2) {
        top: 40%;
        animation: lf2 0.8s linear infinite;
        animation-delay: -1s;
      }
      .longfazers span:nth-child(3) {
        top: 60%;
        animation: lf3 0.6s linear infinite;
      }
      .longfazers span:nth-child(4) {
        top: 80%;
        animation: lf4 0.5s linear infinite;
        animation-delay: -3s;
      }

      @keyframes lf {
        0% {
          left: 200%;
        }
        100% {
          left: -200%;
          opacity: 0;
        }
      }
      @keyframes lf2 {
        0% {
          left: 200%;
        }
        100% {
          left: -200%;
          opacity: 0;
        }
      }
      @keyframes lf3 {
        0% {
          left: 200%;
        }
        100% {
          left: -100%;
          opacity: 0;
        }
      }
      @keyframes lf4 {
        0% {
          left: 200%;
        }
        100% {
          left: -100%;
          opacity: 0;
        }
      }
      /* Loader */
      .date-input {
        border: 1px solid #ebedf2 !important;
        margin-bottom: 20px;
        padding: 5px 20px;
        border-radius: 4px;
      }
      .app-header-mobile {
        display: none;
      }
      @media screen and (max-width: 768px) {
        .app-aside {
          box-shadow: 0 0 20px 10px rgb(0 0 0 / 6%);
        }
        .hide,
        .hide li,
        .hide button,
        .hide.app-aside .logo-wrapper img {
          width: 0px;
          padding: 0;
          text-indent: -1000px;
        }
        .hide.app-aside .logo-wrapper {
          width: 0;
          padding: 0;
        }

        .hide.app-aside {
          box-shadow: none;
        }
        .app-header {
          top: 10px;
          width: 94%;
        }
        .app-header-mobile {
          display: flex;
          justify-content: space-between;
          align-items: center;
          width: 100%;
        }
        .logo-img {
          filter: none;
        }
        .logo-wrapper {
          border-bottom: 1px solid #eff0f6;
          background-color: #ffffff;
          transition: none;
        }
      }
    </style>

    <title>Hippo | Dashboard</title>
  </head>
  <body class="">
    <div class="se-pre-con">
      <div class="loader-body">
        <span>
          <span></span>
          <span></span>
          <span></span>
          <span></span>
        </span>
        <div class="base">
          <span></span>
          <div class="face"></div>
        </div>
      </div>
      <div class="longfazers">
        <span></span>
        <span></span>
        <span></span>
        <span></span>
      </div>
      <h2>Loading...</h2>
    </div>
    <div class="app-main">
      <div class="app-aside hide">
        <div class="logo-wrapper">
          <img src="images/logo.png" height="40px" class="logo-img" />
        </div>
        <div class="aside-content">
          <ul>
            <li>
              <button>Apartment Renovation</button>
            </li>
            <li><button>New House Construction</button></li>
            <li><button>Kitchen Construction</button></li>
            <li><button>Bathroom Renovation</button></li>
            <li><button>Design Session</button></li>
            <li><button id="contact-details">Contact Details</button></li>
          </ul>
        </div>
      </div>
      <div class="app-mainBody">
        <div class="app-mainContent">
          <div class="app-header">
            <div class="app-header-mobile">
              <img src="images/logo.png" height="40px" class="logo-img" />
              <div class="menu-click" onclick="toggleMenu()">
                <img src="images/menu.png" height="30px" />
              </div>
            </div>
          </div>
          <div>
            <input type="text" name="daterange" class="date-input" />
          </div>
          <div class="app-tableContent">
            <table
              class="dataTable table table-striped display nowrap"
              id="example"
              style="width: 100%"
            ></table>
          </div>
        </div>
        <div class="app-extra-space"></div>
        <div class="app-footer"></div>
      </div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.print.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js"></script>
    <script src="./toucan.js"></script>
    <script src="./offcanvas.js"></script>
    <script defer>
      function toggleMenu() {
        $(".app-aside").toggleClass("hide")
      }
      async function removeDuplicates(key) {
        let lookup = new Set()
        array = await getFormData()
        return array.filter(
          (obj) =>
            !lookup.has(obj.submitted_at[key]) &&
            lookup.add(obj.submitted_at[key])
        )
      }

      $(document).ready(function () {
        var start = moment()
        var end = moment()
        let data = removeDuplicates("date")
        $('input[name="daterange"]').daterangepicker(
          {
            showDropdowns: true,
            ranges: {
              Today: [moment(), moment()],
              Yesterday: [
                moment().subtract(1, "days"),
                moment().subtract(1, "days"),
              ],
              "Last 7 Days": [moment().subtract(6, "days"), moment()],
              "Last 30 Days": [moment().subtract(29, "days"), moment()],
              "This Month": [
                moment().startOf("month"),
                moment().endOf("month"),
              ],
              "Last Month": [
                moment().subtract(1, "month").startOf("month"),
                moment().subtract(1, "month").endOf("month"),
              ],
            },
            alwaysShowCalendars: true,
            startDate: start,
            endDate: end,
          },
          function (s, e, label) {
            start = s
            end = e
            console.log(
              "New date range selected: " +
                s.format("YYYY-MM-DD") +
                " to " +
                e.format("YYYY-MM-DD") +
                " (predefined range: " +
                label +
                ")"
            )
            filterData(activeDomain, s, e)
          }
        )

        let activeDomain = $(".aside-content button.active")
          .text()
          .trim()
          .toLowerCase()
          .replaceAll(" ", "-")
        let COLUMNS = []
        let DATA = []
        var results = []
        var myTable
        function InitializeDataTables(start, end, data) {
          myTable = $("#example").DataTable({
            dom: "Bfrtip",
            sPaginationType: "full_numbers",
            data: data
              .filter((d) =>
                activeDomain === "contact-details"
                  ? [...Object.values(d.form_data)].length === 4 &&
                    d.form_data.domain !== "Free-design-sessionp-for-kitchen"
                  : activeDomain === "design-session"
                  ? [...Object.values(d.form_data)].length === 4 &&
                    d.form_data.domain === "Free-design-sessionp-for-kitchen"
                  : [...Object.values(d.form_data)].length > 4 &&
                    d.form_data.domain === `Honest-Budget-for-${activeDomain}`
              )
              .filter((d) => {
                return (
                  moment(d.submitted_at.date).format("x") >=
                    moment(start).startOf("day").format("x") &&
                  moment(d.submitted_at.date).format("x") <=
                    moment(end).endOf("day").format("x")
                )
              })
              .map((d) => {
                return [
                  ...DATA.map((colName) => d.form_data[colName] || "--"),
                  d.submitted_at.date.substring(0, 11),
                  d.submitted_at.date.substring(11, 19),
                ]
              }),
            columns: COLUMNS,
            buttons: ["csv", "excel", "print"],
            scrollX: true,
          })
        }

        const filterData = (activeDomain, start, end) => {
          switch (activeDomain.replaceAll("-", "").toUpperCase()) {
            case "CONTACTDETAILS":
              COLUMNS = [
                { title: "Name" },
                { title: "Mobile" },
                { title: "Email" },
                { title: "Domain" },
                { title: "Date" },
                { title: "Time" },
              ]
              DATA = ["name", "Mobile_No_", "email", "domain"]
              break

            case "DESIGNSESSION":
              COLUMNS = [
                { title: "Name" },
                { title: "Mobile" },
                { title: "Email" },
                { title: "Domain" },
                { title: "Date" },
                { title: "Time" },
              ]
              DATA = ["name", "Mobile_No_", "email", "domain"]
              break
            case "APARTMENTRENOVATION":
              COLUMNS = [
                { title: "Name" },
                { title: "Mobile" },
                { title: "Email" },
                { title: "Domain" },
                { title: "Site Address" },
                { title: "Pincode" },
                { title: "Apartment Size In Sq Ft" },
                { title: "Total No Of Bathrooms" },
                { title: "Total No Of Rooms" },
                { title: "Date" },
                { title: "Time" },
              ]
              DATA = [
                "name",
                "mobile",
                "email",
                "domain",
                "Site_Address",
                "pincode",
                "Apartment_Size_In_Sq_Ft",
                "Total_No__Of_Bathrooms",
                "Total_No__Of_Rooms",
              ]

              break

            case "BATHROOMRENOVATION":
              COLUMNS = [
                { title: "Name" },
                { title: "Mobile" },
                { title: "Email" },
                { title: "Domain" },
                { title: "Site Address" },
                { title: "Pincode" },
                { title: "Total No Of Bathrooms" },
                { title: "Length in feet" },
                { title: "Width in feet" },
                { title: "Date" },
                { title: "Time" },
              ]
              DATA = [
                "name",
                "mobile",
                "email",
                "domain",
                "Site_Address",
                "pincode",
                "Total_No__Of_Bathrooms",
                "Length_in_feet",
                "Width_in_feet:",
              ]
              break
            case "KITCHENCONSTRUCTION":
              COLUMNS = [
                { title: "Name" },
                { title: "Mobile" },
                { title: "Email" },
                { title: "Domain" },
                { title: "Site Address" },
                { title: "Pincode" },
                { title: "Kitchen Shape" },
                { title: "Length in feet" },
                { title: "Width in feet" },
                { title: "Date" },
                { title: "Time" },
              ]
              DATA = [
                "name",
                "mobile",
                "email",
                "domain",
                "Site_Address",
                "pincode",
                "Kitchen_Shape",
                "Length_in_feet",
                "Width_in_feet:",
              ]

              break

            case "NEWHOUSECONSTRUCTION":
              COLUMNS = [
                { title: "Name" },
                { title: "Mobile" },
                { title: "Email" },
                { title: "Domain" },
                { title: "Site Address" },
                { title: "Pincode" },
                { title: "Ground Floor Stilt" },
                { title: "Plot Size In Sq Yds" },
                { title: "Total No Of Kitchens" },
                { title: "Total No of Bathrooms" },
                { title: "Total No of Rooms" },
                { title: "Basement" },
                { title: "No Of Floors" },
                { title: "Date" },
                { title: "Time" },
              ]
              DATA = [
                "name",
                "mobile",
                "email",
                "domain",
                "Site_Address",
                "pincode",
                "GroundFloorStilt",
                "Plot_Size_In_Sq_Yds",
                "Total_No__Of_Kitchens",
                "Total_No__of_Bathrooms",
                "Total_No__of_Rooms",
                "basement",
                "nooffloors",
              ]

              break

            default:
              COLUMNS = []
              DATA = []
              break
          }
          if (myTable != undefined && myTable != null) {
            myTable.destroy()
            myTable = null
            $(".app-tableContent").html("")
            $(".app-tableContent").append(
              '<table class="dataTable table table-striped display nowrap" id="example" style="width: 100%"></table>'
            )
            data.then((d) => {
              InitializeDataTables(start, end, d)
              $(".se-pre-con").fadeOut("slow")
            })
          } else {
            data.then((d) => {
              InitializeDataTables(start, end, d)
              $(".se-pre-con").fadeOut("slow")
            })
          }
        }
        $(".aside-content").on("click", "button", function () {
          $(".aside-content button.active").removeClass("active")
          $(this).addClass("active")
          activeDomain = $(this)
            .text()
            .trim()
            .toLowerCase()
            .replaceAll(" ", "-")
          filterData(activeDomain, start, end)
        })
        $("#contact-details").on("click", "button", function () {
          $(".aside-content button.active").removeClass("active")
          $(this).addClass("active")
          activeDomain = $(this)
            .text()
            .trim()
            .toLowerCase()
            .replaceAll(" ", "-")
          filterData(activeDomain, start, end)
        })
        $("#contact-details").click()
      })
    </script>
  </body>
</html>
